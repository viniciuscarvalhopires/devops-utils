FROM nginx:latest

COPY nginx.sh /

# Evitar erro de compatibilidade do script desenvolvido no Windows p/ Linux
RUN apt-get update && \
    apt install dos2unix && \
    dos2unix nginx.sh

RUN apt-get update && \
    apt-get install -y fcgiwrap spawn-fcgi && \
    mv /usr/sbin/fcgiwrap /usr/bin/ && \
    mkdir /var/run/fcgiwrap && \
    mkdir /usr/lib/cgi-bin -p && \
    chown www-data:www-data /var/run/fcgiwrap && \
    chmod 755 /var/run/fcgiwrap && \
    chmod +x nginx.sh
   

COPY fcgiwrap.conf /etc/nginx/
COPY default.conf /etc/nginx/conf.d/
COPY test.cgi /usr/lib/cgi-bin/

EXPOSE 80

ENTRYPOINT ["/bin/bash", "./nginx.sh"]